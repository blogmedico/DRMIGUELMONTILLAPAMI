<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Notas PRO</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f6f9; }
    h1 { text-align: center; }
    textarea { width: 100%; height: 80px; margin-bottom: 10px; }
    input[type="text"] { width: 100%; padding: 8px; margin-bottom: 10px; }
    button { margin: 5px; padding: 8px 12px; cursor: pointer; border: none; border-radius: 6px; }
    .add { background: #4CAF50; color: white; }
    .delete { background: #f44336; color: white; }
    .merge { background: #2196F3; color: white; }
    .save { background: #ff9800; color: white; }
    .copy { background: #9c27b0; color: white; }
    .note { background: white; padding: 10px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .note-date { font-size: 12px; color: gray; }
    mark { background: yellow; }
  </style>
</head>
<body>
  <h1>Gestor de Notas PRO</h1>

  <textarea id="nota" placeholder="Escribe tu nota aquí..."></textarea><br>
  <button class="add" onclick="agregarNota()">Agregar Nota</button>
  <button class="merge" onclick="unirNotas()">Unir Notas</button>
  <button class="save" onclick="guardarTXT()">Guardar TXT</button>
  <button class="copy" onclick="copiarTodo()">Copiar Todo</button>

  <input type="text" id="buscar" placeholder="Buscar notas..." oninput="filtrarNotas()">

  <div id="listaNotas"></div>

  <script>
    let notas = JSON.parse(localStorage.getItem("notas")) || [];

    function mostrarNotas(filtro="") {
      let contenedor = document.getElementById("listaNotas");
      contenedor.innerHTML = "";

      notas.sort((a,b) => new Date(b.fecha) - new Date(a.fecha)); // ordena más recientes arriba

      notas.forEach((nota, index) => {
        let texto = nota.texto;
        if (filtro) {
          let regex = new RegExp(`(${filtro})`, "gi");
          texto = texto.replace(regex, "<mark>$1</mark>");
        }

        let div = document.createElement("div");
        div.className = "note";
        div.innerHTML = `
          <div>${texto}</div>
          <div class="note-date">${nota.fecha}</div>
          <button class="delete" onclick="eliminarNota(${index})">Eliminar</button>
        `;
        contenedor.appendChild(div);
      });
    }

    function agregarNota() {
      let texto = document.getElementById("nota").value.trim();
      if (!texto) return;
      let fecha = new Date().toLocaleString();
      notas.push({texto, fecha});
      localStorage.setItem("notas", JSON.stringify(notas));
      document.getElementById("nota").value = "";
      mostrarNotas();
    }

    function eliminarNota(index) {
      notas.splice(index, 1);
      localStorage.setItem("notas", JSON.stringify(notas));
      mostrarNotas();
    }

    function unirNotas() {
      if (notas.length === 0) return;
      let textoUnido = notas.map(n => `[${n.fecha}] ${n.texto}`).join("\n\n");
      let fecha = new Date().toLocaleString();
      notas = [{texto: textoUnido, fecha}];
      localStorage.setItem("notas", JSON.stringify(notas));
      mostrarNotas();
    }

    function guardarTXT() {
      let contenido = notas.map(n => `[${n.fecha}] ${n.texto}`).join("\n\n");
      let blob = new Blob([contenido], { type: "text/plain" });
      let enlace = document.createElement("a");
      enlace.href = URL.createObjectURL(blob);
      enlace.download = "notas.txt";
      enlace.click();
    }

    function copiarTodo() {
      let contenido = notas.map(n => `[${n.fecha}] ${n.texto}`).join("\n\n");
      navigator.clipboard.writeText(contenido);
      alert("Notas copiadas al portapapeles");
    }

    function filtrarNotas() {
      let filtro = document.getElementById("buscar").value;
      mostrarNotas(filtro);
    }

    mostrarNotas();
  </script>
</body>
</html>
